# Телеграм бот для пребординга и онбординга для помощи ресторанам в подборе и обучении персонала

Телеграм бот в помощь ресторанам - результат работы команды №3 проектного месяца курса "яндекс разработчик расширенный".
Функционал бота разделён на три части, согласно ролям пользователей.
- USER - для стажёра, позволяет просматривать актуальный статус назначенной дорожной карты, отправлять сообщение менеджеру и отправлять запросы на прекращение стажировки
- MANAGER - для менеджера ресторана, включает в себя управление назначенными стажёрами и их дорожными картами.
- ADMIN - администраторская часть, которая включает полное управление пользователями, ресторанами и дорожными картами.

## Цели и задачи проекта
- Ускорение процесса адаптации
- Повышение вовлечённости
- Оптимизация управления персоналом
- Экономия ресурсов

## Используемый стек и технологии

### Backend

- Python, Aiogram
- PostgreSQL, SQLAlchemy (база данных), Alembic, Redis

### Инструменты разработки

- Docker (контейнеризация)
- Git (система контроля версий)
- GitHub Actions (CI/CD практики)


##  Структура и назначение папок и файлов проекта

### .github/workflows/
**файлы для CI/CD**
### docs/
**дополнительная документация**
### infra/
**папка с конфигурационными файлами инфраструктуры**
### src/
**Основной код проекта**

- *admin/*  - код работы с функционалом администратора
- *alembic/* - директория с миграциями для БД
- *common/* - общая логика (/start и /help)
- *crud/* - директория с функциями обращения к БД
- *data/* - фикстуры для заполнения БД  данным
- *intern/* - код работы с функционалом стажёра
- *manager/* - код работы с функционалом менеджера
- *middlewares/* - мидлвары (точка входа в БД, проверка прав)
- *models/* - таблицы БД
- *Dockerfile* -
- *alembic.ini* - файл конфигурации alembic
- *config.py* - файл с основными настройками проекта
- *create_admin.py* - скрипт с логикой создания администратора при старте проекта
- *data_script.py* - скрипт для заполенения БД фикстурами из data/
- *engine.py* - файл с "движком" БД (генератором асинхронных сессий)
- *main.py* - основной файл запуска проекта
- *requirements.txt* - зависимости, необходимые для запуска проекта

### .gitignore
### .pre-commit-config.yaml
### README.md
### requirements_style.txt
### ruff.toml


## Инструкция для пользователей
Обратитесь к администратору проекта, чтобы получить доступ к системе.
Приготовьте свой telegram ID  (можно узнать у этого бота **@getmyid_bot**)

### Стажёр (USER)

**Посмотреть статус дорожной карты** -
Показывает общую картину прохождения дорожной карты

**Посмотреть текущую контрольную точку** -
Показывает актуальную в настоящий момент контрольную точку

**Отправить сообщение менеджеру** -
Отправляет сообщение менеджеру

**Прекратить прохождение дорожной карты** -
Отправляет запрос менеджеру на прекращение стажировки

### Менеджер (MANAGER)

**Управление шаблонами дорожных карт** -
Позволяет адаптировать назначенные администратором шаблоны дорожных карт

**Управление стажёрами** -
Отображает прикреплённых стажёров, по нажатию на одного из них доступны кнопки
 - **Прогресс обучения** - Показывает актуальный статус дорожной карты стажёра
 - **Написать сообщение** - Отправляет сообщение стажёру
 - **Редактировать дорожную карту** - внесение изменений в дорожную карту стажёра
 - **Управление стажёром** - по нажатию доступен выбор:
   - **Заблокировать стажёра** - блокирует стажёра
   - **Завершить обучение стажёра** - досрочно завершает обучение стажёра


### Администратор (ADMIN)

Администраторская часть позволяет управлять всем функционалом проекта. Доступны следующие кнопки

**Создать пользователя** - поэтапное создание пользователя путём ввода и выбора необходимых полей
**Редактировать пользователя** - выбор пользователя и его редактирование
**Заблокировать пользоватвеля** - выбор пользователя и его блокировка

**Привязать пользователя к ресторану** - привязывает пользователя к определённому ресторану

**Создать ресторан** - поэтапное создание ресторана путём ввода и выбора необходимых полей
**Редактировать ресторан** - выбор ресторана и его редактирование
**Заблокировать ресторан** - выбор ресторана и его блокировка

**Создать шаблон дорожной карты** - поэтапное создание шаблона ДК путём ввода и выбора необходимых полей
**Редактировать шаблон дорожной карты** - выбор шаблона ДК и его редактирование
**Заблокировать шаблон дорожной карты** - выбор шаблона ДК и его блокировка

**Привязать шаблон дорожной карты к ресторану** - привязывает шаблон ДК к определённому ресторану

**Создать тест** - поэтапное создание теста и привязка к ресторану

**Сгенерировать приглашение** - генерация ссылки приглашения

## Порядок развертывания, настройки и запуска проекта

### В проекте настроен пайплайн CI/CD GitHub Actions. Это позволяет запускать проект на собственном сервере, осуществлять поддержку и выпуск новых релизов. Информация об успешном деплое приходит через отдельный телеграм-бот(его нужно отдельно создать через botfather telegram).
---
### 1. Форк репозитория:

Перейдите в репозиторий проекта GitHub
```
https://github.com/Studio-Yandex-Practicum/smena_collective_team3
```
Нажмите "Fork" в правом верхнем углу. Это создаст копию проекта в вашем аккаунте на GitHub:
```
https://github.com/ваша-аккаунт/имя-репозитория
```

---

### 2. Настройка секретов GitHub Actions

Перейдите  `Settings → Secrets and variables → Actions` вашего репозитория и добавьте переменные:

| Название         | Описание                                                        |
|------------------|-----------------------------------------------------------------|
| `DOCKER_PASSWORD`| Пароль пользователя DockerHub                                   |
| `DOCKER_USERNAME`| Имя пользователя DockerHub                                      |
| `HOST`           | IP-адрес или домен вашего сервера                               |
| `REDIS_PORT`     | Порт redis для запуска CI-задачи в github runner                |
| `SSH_KEY`        | Приватный SSH-ключ для доступа на ваш сервер                    |
|`SSH_PASSPHRASE`| Парольная фраза пары ключей для доступа на ваш сервер             |
|`TELEGRAM_TO`| Телеграм ID пользователя или группы для сообщения об успешном деплое |
|`TELEGRAM_TOKEN`|Токен телеграм-бота для сообщения об успешном деплое               |
|`USER`          | Имя пользователя на вашем сервере                                 |
**Важно:** Убедитесь, что:
- Пользователь имеет доступ к серверу по SSH-ключам
- На сервере установлен Docker и Docker Compose
- Путь `/opt/smena/` существует
---

### 3. Запуск и деплой проекта
_Шаги приведены для ОС Windows 11 c установленным Git Bash_
Клонируйте репозиторий локально:
```
git@github.com:ваш-аккаунт/smena_collective_team3.git
```
#### 3.1 Локальный запуск проекта (режим разработки)
Перейдите в директорию с кодом проекта
```
cd src/
```
Создайте файл `.env`, в файле укажите значения переменных по образцу `.env.example`. В случае локального запуска переменную `REDIS_PASSWORD` следует оставить пустой после знака `=`;
```
touch .env
```
Установите и активируйте виртуальное окружение
```
python -m venv venv && source venv/scripts/activate
```
Обновите менеджер пакетов и установите зависимости из файла requirements.txt:
```
python -m pip install --upgrade pip
```
```
pip install -r requirements.txt
```
Перейдите в директорию `infra`
```
cd ../infra
```
Убедитесь, что Docker Desktop запущен на вашем компьютере, запустите проект:
```
docker compose -f docker-compose.local.yml up
```
Перейдите в  `src/` и примените миграции:
```
alembic upgrade head
```
Проект готов к работе. `src/` смонтирована в контейнер как volume — изменения в коде сразу отражаются в контейнере.Чтобы перезапустить контейнер с ботом находясь в директории ```infra``` выполните команду:
```
docker-compose -f docker-compose.local.yml restart bot
```
Таким образом изменения в коде попадут в контейнер.
#### 3.2 Деплой проекта и запуск на удаленном сервере
Целевая директория для деплоя: `/opt/smena/`. Создайте каталог на вашем сервере и перейдите в него:
```
sudo mkdir -p /opt/smena/ && cd /opt/smena/
```
Создайте файл `.env`. В файле укажите значения переменных по образцу `.env.example`.
```
touch .env
```
На локальном компьютере в папке проекта выполните команды:
```
git commit --allow-empty -m "Инициализация деплоя" && git push
```
CI/CD запускается автоматически при `push` в основную ветку. Этапы:
✅ Проверка кода (PEP8 + автотесты)
🐳 Сборка и публикация Docker-образа
🚀 Деплой на сервер по SSH
📬 Уведомление в Telegram

Результат выполнения доступен на вкладке `Actions` проекта.
#### 3.3 Загрузка данных
Команды выполняются при запущенном `docker-compose`.
- Создание учетной записи адмнистратора бота:
```
docker exec -it bot-cont python create_admin.py
```
- Загрузка предустановленных фикстур:
```
docker exec -it bot-cont python data_script.py
```

## Нереализованный функционал
1. Тестирование(обработка тестов, создание, редактирование и тд.)
2. Стажёр не привязывается к менеджеру через интерфейс бота.
3. Не все объекты бд создаются / редактируются через интерфейс бота.
4. Валидация данных при вводе (частично)

## Команда проекта

- **Александров Дмитрий** - *https://github.com/DmitryAlexandrov91*
- **Дмитрий Файзуллин** - *https://github.com/DmitriFaizullin*
- **Лев Коробейников** - *https://github.com/LevKorobeinikov*
- **Данил Тиводар** - *https://github.com/daniltivodar*
- **Александр Тряпышко** *https://github.com/AlexanderTryapyshko*
- **Алексей Пакаев** *https://github.com/Alexshifter*
- **Михаил Смирнов** *https://github.com/smirnovmn*
- **Тимофей Глухов** *https://github.com/tvglukhov*
